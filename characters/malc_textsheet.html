<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Malc Grann — Text Sheet</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Cinzel:wght@400;500;600&family=IM+Fell+English:ital@0;1&display=swap" rel="stylesheet">
<style>
  :root {
    /* Steel + Bronze (match Malc sheet vibe) */
    --primary: #aeb6bf;
    --primary-light: #d6dde6;
    --primary-bright: #f2f5ff;
    --primary-dim: #5a6575;

    --accent: #b07a2a;         /* bronze */
    --accent-light: #e0b060;
    --accent-bright: #ffd58a;

    --dark: #05060a;
    --dark-panel: #080a10;
    --dark-border: #141824;

    --text-cream: #d8dde8;
    --text-dim: #7a8396;

    --blood: #8b1a1a;
    --wall: #2a3b52;
  }

  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    background: var(--dark); color: var(--text-cream);
    font-family: 'Cinzel', serif; min-height: 100vh;
    background-image:
      radial-gradient(ellipse at 50% 0%, rgba(42,59,82,0.18) 0%, transparent 60%),
      radial-gradient(ellipse at 80% 85%, rgba(176,122,42,0.06) 0%, transparent 40%),
      repeating-linear-gradient(0deg, transparent, transparent 50px, rgba(174,182,191,0.012) 50px, rgba(174,182,191,0.012) 51px),
      repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(42,59,82,0.018) 50px, rgba(42,59,82,0.018) 51px);
  }

  /* PAGE */
  .page {
    max-width: 900px; margin: 30px auto;
    background: #070810; border: 1px solid rgba(176,122,42,0.55);
    position: relative; padding: 30px; page-break-after: always;
  }
  .page::before {
    content:''; position:absolute; top:0;left:0;right:0;height:2px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
  }

  /* NAME BANNER */
  .name-banner { display:grid; grid-template-columns:280px 1fr; border:1px solid rgba(176,122,42,0.45); margin-bottom:24px; }
  .name-box { border-right:1px solid rgba(176,122,42,0.45); padding:14px 20px; background: rgba(42,59,82,0.10); }
  .char-name-big {
    font-family:'Cinzel Decorative',serif; font-size:36px; font-weight:900;
    background:linear-gradient(180deg,var(--primary-bright),var(--primary));
    -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
    filter:drop-shadow(0 0 20px rgba(176,122,42,0.5)); line-height:1.1;
  }
  .name-sub { font-size:8px; letter-spacing:4px; color: var(--primary-dim); text-transform:uppercase; margin-top:4px; }
  .info-grid { display:grid; grid-template-columns:1fr 1fr 1fr; grid-template-rows:1fr 1fr; }
  .info-cell { padding:8px 14px; border-left:1px solid var(--dark-border); border-bottom:1px solid var(--dark-border); background: rgba(8,10,16,0.5); }
  .info-cell:nth-child(n+4) { border-bottom:none; }
  .info-label { font-size:7px; letter-spacing:3px; color: var(--primary-dim); text-transform:uppercase; display:block; margin-bottom:2px; }
  .info-value { font-size:12px; color: var(--accent-light); font-weight:600; }

  /* SHEET BODY */
  .sheet-body { display:grid; grid-template-columns:160px 1fr 220px; gap:16px; }

  /* ABILITY SCORES */
  .ability-col { display:flex; flex-direction:column; gap:8px; }
  .ability-block { border:1px solid rgba(176,122,42,0.35); text-align:center; padding:10px 6px 8px; background:rgba(42,59,82,0.08); }
  .ability-block:hover { background:rgba(42,59,82,0.16); }
  .ab-name { font-size:7px; letter-spacing:3px; color:var(--primary-dim); text-transform:uppercase; display:block; margin-bottom:4px; }
  .ab-score { font-family:'Cinzel Decorative',serif; font-size:32px; color:var(--primary-light); line-height:1; display:block; }
  .ab-mod-box { display:inline-block; border:1px solid rgba(176,122,42,0.35); padding:2px 10px; margin-top:6px; font-size:14px; color:var(--accent-light); font-weight:700; }
  .proficiency-box { border:1px solid rgba(176,122,42,0.35); padding:10px; text-align:center; background:rgba(42,59,82,0.08); margin-top:4px; }
  .prof-val { font-family:'Cinzel Decorative',serif; font-size:24px; color:var(--accent-light); }
  .prof-lbl { font-size:7px; letter-spacing:2px; color:var(--primary-dim); text-transform:uppercase; display:block; margin-top:2px; }

  /* MID COL */
  .mid-col { display:flex; flex-direction:column; gap:12px; }

  /* SECTION */
  .section { border:1px solid var(--dark-border); background:var(--dark-panel); position:relative; }
  .section::before { content:''; position:absolute; top:0;left:0;right:0;height:1px; background:linear-gradient(90deg,transparent,rgba(176,122,42,0.55),transparent); }
  .section-title { font-size:7px; letter-spacing:4px; color:var(--primary-dim); text-transform:uppercase; padding:8px 14px; border-bottom:1px solid var(--dark-border); text-align:center; }
  .section-body { padding:12px 14px; }

  /* COMBAT */
  .combat-row { display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; }
  .combat-stat { text-align:center; padding:10px 4px; border:1px solid var(--dark-border); background:rgba(42,59,82,0.07); }
  .cs-val { font-family:'Cinzel Decorative',serif; font-size:24px; color:var(--accent-light); display:block; line-height:1; }
  .cs-lbl { font-size:7px; letter-spacing:2px; color:var(--primary-dim); text-transform:uppercase; display:block; margin-top:4px; }

  /* SAVES & SKILLS */
  .save-list { display:flex; flex-direction:column; gap:3px; }
  .save-row { display:flex; align-items:center; gap:8px; padding:3px 0; border-bottom:1px solid rgba(42,59,82,0.12); font-size:11px; }
  .dot { width:8px; height:8px; border-radius:50%; border:1px solid rgba(176,122,42,0.35); flex-shrink:0; }
  .dot.filled { background:var(--primary-light); border-color:var(--primary-light); box-shadow:0 0 6px rgba(224,176,96,0.35); }
  .save-name { flex:1; color:var(--text-cream); }
  .save-val { color:var(--primary-light); font-weight:700; font-size:12px; }

  .skill-list { display:grid; grid-template-columns:1fr 1fr; gap:2px 12px; }
  .skill-row { display:flex; align-items:center; gap:6px; padding:3px 0; border-bottom:1px solid rgba(42,59,82,0.12); font-size:10px; }
  .skill-name { flex:1; color:var(--text-cream); font-size:10px; }
  .skill-ab { font-size:8px; color:var(--text-dim); }
  .skill-val { color:var(--primary-light); font-weight:700; font-size:11px; }

  /* ATTACK TABLE */
  .attack-table { width:100%; border-collapse:collapse; }
  .attack-table th { font-size:7px; letter-spacing:2px; color:var(--primary-dim); text-transform:uppercase; padding:4px 8px; border-bottom:1px solid var(--dark-border); text-align:left; }
  .attack-table td { padding:7px 8px; border-bottom:1px solid var(--dark-border); font-size:11px; color:var(--text-cream); }
  .attack-table td.val { color:var(--accent-light); font-family:'Cinzel Decorative',serif; font-size:13px; }

  /* SECOND WIND TRACKER */
  .wind-pip {
    width:16px; height:16px; border:1px solid rgba(176,122,42,0.45);
    transform:rotate(45deg); cursor:pointer; transition:all 0.3s; display:inline-block;
    background: rgba(42,59,82,0.10);
  }
  .wind-pip.active { background: var(--wall); border-color: var(--accent-light); box-shadow:0 0 10px rgba(224,176,96,0.35); }

  /* DEATH PIPS */
  .pip { width:14px; height:14px; border:1px solid rgba(176,122,42,0.35); border-radius:50%; cursor:pointer; transition:all 0.3s; display:inline-block; }

  /* RIGHT COL */
  .right-col { display:flex; flex-direction:column; gap:12px; }
  .passive-box { border:1px solid var(--dark-border); padding:10px 12px; text-align:center; background:rgba(42,59,82,0.08); }
  .passive-val { font-family:'Cinzel Decorative',serif; font-size:28px; color:var(--accent-light); display:block; }
  .passive-lbl { font-size:7px; letter-spacing:2px; color:var(--primary-dim); text-transform:uppercase; }

  /* DROPDOWN FEATURES */
  .feature-item { border-bottom:1px solid var(--dark-border); }
  .feature-item:last-child { border-bottom:none; }
  .feature-toggle { display:flex; align-items:center; gap:8px; padding:8px 0; cursor:pointer; user-select:none; list-style:none; transition:background 0.2s; }
  .feature-toggle:hover { background:rgba(42,59,82,0.10); }
  .feature-toggle::-webkit-details-marker { display:none; }
  .feature-gem { width:5px; height:5px; background:var(--accent-light); transform:rotate(45deg); flex-shrink:0; box-shadow:0 0 6px rgba(224,176,96,0.35); }
  details[open] .feature-gem { background:var(--accent-bright); box-shadow:0 0 12px rgba(255,213,138,0.55); }
  .feat-name { font-size:10px; color:var(--primary-light); font-weight:600; flex:1; }
  .feat-short { font-family:'IM Fell English',serif; font-size:9px; color:var(--text-dim); margin-left:auto; font-style:italic; }
  .feat-arrow { font-size:8px; color:var(--primary-dim); transition:transform 0.3s; flex-shrink:0; }
  details[open] .feat-arrow { transform:rotate(90deg); color:var(--accent-light); }
  .feature-detail { padding:6px 14px 10px 20px; font-family:'IM Fell English',serif; font-size:11px; color:var(--text-dim); line-height:1.7; border-top:1px solid rgba(42,59,82,0.18); animation:dropIn 0.2s ease; }
  .feature-detail strong { color:var(--primary-light); font-style:normal; }
  .feature-detail em { color:var(--accent-light); }

  /* ATTACK EXPAND */
  .attack-name-cell { cursor:pointer; }
  .attack-name-cell:hover { color:var(--accent-light); }
  .atk-chevron { font-size:8px; color:var(--primary-dim); margin-left:4px; transition:transform 0.3s; }
  .atk-chevron.open { transform:rotate(90deg); color:var(--accent-light); }
  .attack-detail-row td { padding:0 8px; border-bottom:1px solid var(--dark-border); }
  .attack-expand { font-family:'IM Fell English',serif; font-size:10px; color:var(--text-dim); line-height:1.6; padding:6px 0 8px; display:none; animation:dropIn 0.2s ease; }
  .attack-expand.open { display:block; }

  /* TRAITS */
  .trait-details { border-bottom:1px solid var(--dark-border); }
  .trait-details:last-child { border-bottom:none; }
  .trait-summary { list-style:none; padding:7px 6px; font-size:7px; letter-spacing:3px; color:var(--primary-dim); text-transform:uppercase; cursor:pointer; display:flex; align-items:center; gap:6px; user-select:none; }
  .trait-summary::-webkit-details-marker { display:none; }
  .trait-summary:hover { color:var(--accent-light); }
  .trait-arrow { font-size:7px; color:var(--primary-dim); transition:transform 0.3s; }
  details[open] .trait-arrow { transform:rotate(90deg); color:var(--accent-light); }
  .trait-body { padding:6px 10px 10px; font-family:'IM Fell English',serif; font-size:11px; color:var(--text-cream); line-height:1.6; font-style:italic; animation:dropIn 0.2s ease; }

  /* EQUIP */
  .equip-item { display:flex; align-items:center; gap:6px; padding:4px 0; border-bottom:1px solid rgba(42,59,82,0.12); font-family:'IM Fell English',serif; font-size:11px; color:var(--text-dim); }
  .equip-item::before { content:'◆'; font-size:5px; color:rgba(176,122,42,0.55); }

  /* LORE */
  .lore-box { border:1px solid var(--dark-border); padding:14px; background:rgba(42,59,82,0.08); font-family:'IM Fell English',serif; font-size:11px; color:var(--text-dim); line-height:1.8; font-style:italic; }
  .lore-box strong { color:var(--accent-light); font-style:normal; }

  /* PAGE 2 */
  .page2-grid { display:grid; grid-template-columns:260px 1fr; gap:20px; }

  /* Portrait frame */
  .portrait-frame {
    border:1px solid rgba(176,122,42,0.45);
    position:relative; overflow:hidden;
    background: linear-gradient(135deg, rgba(42,59,82,0.30), rgba(0,0,0,0));
  }
  .portrait-frame img { width:100%; display:block; }
  .corner { position:absolute; width:18px; height:18px; }
  .corner.tl { top:0; left:0; border-top:2px solid var(--accent-light); border-left:2px solid var(--accent-light); }
  .corner.tr { top:0; right:0; border-top:2px solid var(--accent-light); border-right:2px solid var(--accent-light); }
  .corner.bl { bottom:0; left:0; border-bottom:2px solid var(--accent-light); border-left:2px solid var(--accent-light); }
  .corner.br { bottom:0; right:0; border-bottom:2px solid var(--accent-light); border-right:2px solid var(--accent-light); }

  @keyframes dropIn { from{opacity:0;transform:translateY(-4px)} to{opacity:1;transform:translateY(0)} }
  @keyframes fadeIn { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)} }
  .page { animation:fadeIn 0.8s ease; }

  @media print {
    body { background: #fff; }
    .page { box-shadow:none; margin:0; border:none; }
  }
</style>
</head>
<body data-character="malc">

<!-- ══════════ PAGE 1 ══════════ -->
<div class="page">

  <div class="name-banner">
    <div class="name-box">
      <div class="char-name-big">Malc Grann</div>
      <div class="name-sub">Character Name</div>
    </div>
    <div class="info-grid">
      <div class="info-cell"><span class="info-label">Class &amp; Level</span><span class="info-value">LVL 1 Fighter</span></div>
      <div class="info-cell"><span class="info-label">Background</span><span class="info-value">Folk Hero</span></div>
      <div class="info-cell"><span class="info-label">Player Name</span><span class="info-value">SirMoosen</span></div>
      <div class="info-cell"><span class="info-label">Race</span><span class="info-value">Gnome</span></div>
      <div class="info-cell"><span class="info-label">Alignment</span><span class="info-value">Neutral</span></div>
      <div class="info-cell"><span class="info-label">Experience Points</span><span class="info-value">(Milestone)</span></div>
    </div>
  </div>

  <div class="sheet-body">

    <!-- ABILITY SCORES -->
    <div class="ability-col">
      <div class="ability-block"><span class="ab-name">Strength</span><span class="ab-score">18</span><div class="ab-mod-box">+4</div></div>
      <div class="ability-block"><span class="ab-name">Dexterity</span><span class="ab-score">12</span><div class="ab-mod-box">+1</div></div>
      <div class="ability-block"><span class="ab-name">Constitution</span><span class="ab-score">18</span><div class="ab-mod-box">+4</div></div>
      <div class="ability-block"><span class="ab-name">Intelligence</span><span class="ab-score">10</span><div class="ab-mod-box">+0</div></div>
      <div class="ability-block"><span class="ab-name">Wisdom</span><span class="ab-score">10</span><div class="ab-mod-box">+0</div></div>
      <div class="ability-block"><span class="ab-name">Charisma</span><span class="ab-score">16</span><div class="ab-mod-box">+3</div></div>
      <div class="proficiency-box"><div class="prof-val">+2</div><span class="prof-lbl">Proficiency Bonus</span></div>
    </div>

    <!-- MIDDLE COL -->
    <div class="mid-col">

      <div class="section">
        <div class="section-body" style="padding:10px 12px;">
          <div class="combat-row">
            <div class="combat-stat"><span class="cs-val">19</span><span class="cs-lbl">Armor Class</span></div>
            <div class="combat-stat"><span class="cs-val">+1</span><span class="cs-lbl">Initiative</span></div>
            <div class="combat-stat"><span class="cs-val">30</span><span class="cs-lbl">Speed (ft)</span></div>
          </div>
        </div>
      </div>

      <!-- HIT POINTS -->
      <div class="section">
        <div class="section-title">Hit Points</div>
        <div class="section-body" style="text-align:center;">
          <div style="font-size:8px;letter-spacing:2px;color:var(--text-dim);text-transform:uppercase;margin-bottom:4px;">Hit Point Maximum: <span id="hp-max">14</span></div>
          <div style="font-family:'Cinzel Decorative',serif;font-size:48px;color:var(--accent-light);line-height:1;" id="hp-current">14</div>
          <div style="display:flex;gap:16px;margin-top:10px;justify-content:center;">
            <div>
              <div style="font-size:8px;letter-spacing:2px;color:var(--primary-dim);text-transform:uppercase;">Hit Dice</div>
              <div style="font-family:'Cinzel Decorative',serif;font-size:18px;color:var(--primary-light);margin-top:2px;" id="hit-dice">1d10</div>
            </div>
            <div style="border-left:1px solid var(--dark-border);padding-left:16px;">
              <div style="font-size:8px;letter-spacing:2px;color:var(--primary-dim);text-transform:uppercase;margin-bottom:6px;">Death Saves</div>
              <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
                <span style="font-size:8px;color:var(--primary-light);min-width:60px;">Successes</span>
                <div style="display:flex;gap:6px;"><div class="pip"></div><div class="pip"></div><div class="pip"></div></div>
              </div>
              <div style="display:flex;align-items:center;gap:8px;">
                <span style="font-size:8px;color:#cc4444;min-width:60px;">Failures</span>
                <div style="display:flex;gap:6px;"><div class="pip" data-fail="1"></div><div class="pip" data-fail="1"></div><div class="pip" data-fail="1"></div></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SAVING THROWS -->
      <div class="section">
        <div class="section-title">Saving Throws</div>
        <div class="section-body">
          <div class="save-list" id="saves-list">
            <div class="save-row"><div class="dot filled"></div><span class="save-name">Strength</span><span class="save-val">+6</span></div>
            <div class="save-row"><div class="dot"></div><span class="save-name">Dexterity</span><span class="save-val">+1</span></div>
            <div class="save-row"><div class="dot filled"></div><span class="save-name">Constitution</span><span class="save-val">+6</span></div>
            <div class="save-row"><div class="dot"></div><span class="save-name">Intelligence</span><span class="save-val">+0</span></div>
            <div class="save-row"><div class="dot"></div><span class="save-name">Wisdom</span><span class="save-val">+0</span></div>
            <div class="save-row"><div class="dot"></div><span class="save-name">Charisma</span><span class="save-val">+3</span></div>
          </div>
          <div style="margin-top:10px;padding:8px 10px;background:rgba(42,59,82,0.10);border:1px solid rgba(42,59,82,0.22);">
            <div style="font-size:7px;letter-spacing:3px;color:var(--primary-dim);text-transform:uppercase;margin-bottom:6px;">Gnomish Cunning</div>
            <div style="font-family:'IM Fell English',serif;font-size:10px;color:var(--text-dim);">
              Advantage on <strong style="color:var(--primary-light);font-style:normal;">INT</strong>, <strong style="color:var(--primary-light);font-style:normal;">WIS</strong>, and <strong style="color:var(--primary-light);font-style:normal;">CHA</strong> saving throws.
            </div>
          </div>
        </div>
      </div>

      <!-- SKILLS -->
      <div class="section">
        <div class="section-title">Skills</div>
        <div class="section-body">
          <div class="skill-list" id="skills-grid">
            <!-- fallback; JSON loader will replace -->
            <div class="skill-row"><div class="dot"></div><span class="skill-name">Animal Handling</span><span class="skill-ab">(Wis)</span><span class="skill-val">+2</span></div>
            <div class="skill-row"><div class="dot"></div><span class="skill-name">History</span><span class="skill-ab">(Int)</span><span class="skill-val">+2</span></div>
            <div class="skill-row"><div class="dot"></div><span class="skill-name">Perception</span><span class="skill-ab">(Wis)</span><span class="skill-val">+2</span></div>
            <div class="skill-row"><div class="dot"></div><span class="skill-name">Survival</span><span class="skill-ab">(Wis)</span><span class="skill-val">+2</span></div>
          </div>
        </div>
      </div>

      <!-- ATTACKS -->
      <div class="section">
        <div class="section-title">Attacks &amp; Spellcasting</div>
        <div class="section-body">
          <table class="attack-table">
            <thead><tr><th>Name</th><th>Atk Bonus</th><th>Damage / Type</th></tr></thead>
            <tbody id="attacks-body">
              <tr>
                <td class="attack-name-cell" onclick="toggleAtk('atk1',this)">Whip <span class="atk-chevron" id="chv1">▶</span></td>
                <td class="val">+6</td><td>1d4+4 Slashing</td>
              </tr>
              <tr class="attack-detail-row"><td colspan="3"><div class="attack-expand" id="atk1"><strong>Whip.</strong> Finesse · Reach. <em>Slow:</em> reduce target speed by 10 ft until start of your next turn.</div></td></tr>

              <tr>
                <td class="attack-name-cell" onclick="toggleAtk('atk2',this)">Unarmed Strike <span class="atk-chevron" id="chv2">▶</span></td>
                <td class="val">+6</td><td>5 Bludgeoning</td>
              </tr>
              <tr class="attack-detail-row"><td colspan="3"><div class="attack-expand" id="atk2">A fist is a brick with opinions.</div></td></tr>

              <tr>
                <td class="attack-name-cell" onclick="toggleAtk('atk3',this)">Mending <span class="atk-chevron" id="chv3">▶</span></td>
                <td class="val">—</td><td>Utility</td>
              </tr>
              <tr class="attack-detail-row"><td colspan="3"><div class="attack-expand" id="atk3">Repair a break or tear in an object you touch.</div></td></tr>

              <tr>
                <td class="attack-name-cell" onclick="toggleAtk('atk4',this)">Prestidigitation <span class="atk-chevron" id="chv4">▶</span></td>
                <td class="val">—</td><td>Utility</td>
              </tr>
              <tr class="attack-detail-row"><td colspan="3"><div class="attack-expand" id="atk4">Minor wonder-working. Also used to make <strong>Tiny Clockwork Devices</strong>.</div></td></tr>
            </tbody>
          </table>

          <div style="margin-top:12px;padding:8px 10px;background:rgba(42,59,82,0.10);border:1px solid rgba(176,122,42,0.22);">
            <div style="font-size:7px;letter-spacing:3px;color:var(--primary-dim);text-transform:uppercase;margin-bottom:6px;">Second Wind Tracker (2 / Long Rest)</div>
            <div style="display:flex;align-items:center;gap:10px;">
              <div class="wind-pip"></div>
              <div class="wind-pip"></div>
              <span style="font-family:'IM Fell English',serif;font-size:10px;color:var(--text-dim);margin-left:8px;">Bonus Action · regain <strong style="color:var(--primary-light);font-style:normal;">1d10 + level</strong> HP</span>
            </div>
          </div>
        </div>
      </div>

      <!-- PROFICIENCIES -->
      <div class="section">
        <div class="section-title">Other Proficiencies &amp; Languages</div>
        <div class="section-body">
          <p id="profs-text" style="font-family:'IM Fell English',serif;font-size:11px;color:var(--text-dim);line-height:1.9;">
            <span style="color:var(--primary-light);font-family:'Cinzel',serif;font-size:8px;letter-spacing:2px;">WEAPONS</span><br>
            Simple Weapons, Martial Weapons<br><br>
            <span style="color:var(--primary-light);font-family:'Cinzel',serif;font-size:8px;letter-spacing:2px;">ARMOR</span><br>
            All Armor, Shields<br><br>
            <span style="color:var(--primary-light);font-family:'Cinzel',serif;font-size:8px;letter-spacing:2px;">TOOLS</span><br>
            Mason's Tools, Tinker's Tools (optional)<br><br>
            <span style="color:var(--primary-light);font-family:'Cinzel',serif;font-size:8px;letter-spacing:2px;">LANGUAGES</span><br>
            Common, Gnomish
          </p>
        </div>
      </div>

    </div><!-- end mid-col -->

    <!-- RIGHT COL -->
    <div class="right-col">

      <div class="passive-box">
        <span class="passive-val" id="pp-val">12</span>
        <span class="passive-lbl">Passive Wisdom (Perception)</span>
      </div>

      <!-- TRAITS -->
      <div class="section" id="traits-box">
        <details class="trait-details">
          <summary class="trait-summary">Personality Traits <span class="trait-arrow">▶</span></summary>
          <div class="trait-body" data-trait="personality">Bright-eyed and delighted by any sufficiently sturdy wall. Speaks of masonry like liturgy.</div>
        </details>
        <details class="trait-details">
          <summary class="trait-summary">Ideals <span class="trait-arrow">▶</span></summary>
          <div class="trait-body" data-trait="ideal">To build is to worship. A perfect wall is proof the world can be made better—stronger—on purpose.</div>
        </details>
        <details class="trait-details">
          <summary class="trait-summary">Bonds <span class="trait-arrow">▶</span></summary>
          <div class="trait-body" data-trait="bond">His “temple wall” is his dream made physical. Anyone who helps lay its first stones becomes part of his myth.</div>
        </details>
        <details class="trait-details">
          <summary class="trait-summary">Flaws <span class="trait-arrow">▶</span></summary>
          <div class="trait-body" data-trait="flaw">He confuses confidence with divinity, and can’t resist proving himself when a structure (or ego) is challenged.</div>
        </details>
      </div>

      <!-- FEATURES -->
      <div class="section">
        <div class="section-title">Features &amp; Traits</div>
        <div class="section-body" style="padding:0;" id="features-list">
          <!-- fallback -->
          <details class="feature-item">
            <summary class="feature-toggle" style="padding:10px 14px;">
              <div class="feature-gem"></div>
              <span class="feat-name">Defense (Fighting Style)</span>
              <span class="feat-short">Passive</span>
              <span class="feat-arrow">▶</span>
            </summary>
            <div class="feature-detail"><strong>+1 AC</strong> while wearing armor. (Included.)</div>
          </details>

          <details class="feature-item">
            <summary class="feature-toggle" style="padding:10px 14px;">
              <div class="feature-gem"></div>
              <span class="feat-name">Second Wind</span>
              <span class="feat-short">2/LR</span>
              <span class="feat-arrow">▶</span>
            </summary>
            <div class="feature-detail">Bonus Action: regain <strong>1d10 + level</strong> HP.</div>
          </details>

          <details class="feature-item">
            <summary class="feature-toggle" style="padding:10px 14px;">
              <div class="feature-gem"></div>
              <span class="feat-name">Rock Gnome Clockwork</span>
              <span class="feat-short">Utility</span>
              <span class="feat-arrow">▶</span>
            </summary>
            <div class="feature-detail">Create <strong>Tiny Clockwork Devices</strong> via <em>Prestidigitation</em>. Up to 3 at once; last 8 hours.</div>
          </details>
        </div>
      </div>

      <!-- EQUIPMENT -->
      <div class="section">
        <div class="section-title">Equipment</div>
        <div class="section-body" id="equip-grid">
          <div class="equip-item">Chain Mail</div>
          <div class="equip-item">Shield</div>
          <div class="equip-item">Whip</div>
          <div class="equip-item">Backpack</div>
          <div class="equip-item">Bedroll</div>
          <div class="equip-item">Mason's Tools</div>
          <div class="equip-item">5 Gold Pieces</div>
        </div>
      </div>

    </div><!-- end right -->
  </div><!-- end sheet-body -->
</div><!-- end page 1 -->


<!-- ══════════════ PAGE 2 ══════════════ -->
<div class="page">
  <div style="text-align:center;margin-bottom:20px;">
    <div class="char-name-big" style="font-size:22px;filter:drop-shadow(0 0 18px rgba(176,122,42,0.45));">Malc Grann</div>
    <div style="font-size:8px;letter-spacing:5px;color:var(--primary-dim);text-transform:uppercase;margin-top:4px;">Character Backstory &amp; Details</div>
  </div>

  <div class="page2-grid">

    <!-- LEFT -->
    <div style="display:flex;flex-direction:column;gap:14px;">

      <!-- PORTRAIT -->
      <div class="portrait-frame">
        <div class="corner tl"></div><div class="corner tr"></div><div class="corner bl"></div><div class="corner br"></div>
        <!-- Put Malc's portrait file next to this HTML as "malc.png" (or update c.portrait in player.json). -->
        <!-- Portrait image (uncomment when malc.png is correct in the repo)
        <img id="portrait-img" src="malc.png" alt="Malc Grann Portrait">
        -->
        <div id="portrait-placeholder" style="width:100%;aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:18px;text-align:center;background:linear-gradient(180deg, rgba(8,10,16,.35), rgba(8,10,16,.75));">
          <div style="font-family:'Cinzel Decorative',serif;font-size:40px;color:var(--primary-light);letter-spacing:2px;text-shadow:0 0 18px rgba(224,176,96,.18);">M.G.</div>
          <div style="font-family:'IM Fell English',serif;font-style:italic;color:var(--text-dim);margin-top:8px;line-height:1.5;">
            Place <strong style="color:var(--accent-light);font-style:normal;">malc.png</strong> in the same folder<br/>and uncomment the image tag above.
          </div>
        </div>
      </div>

      <div class="lore-box">
        <strong>Quote.</strong> <span id="quote-text">“A wall is a promise made of stone. I keep promises.”</span>
      </div>

      <div class="lore-box">
        <strong>Build Notes.</strong><br>
        AC assumes <em>Chain Mail + Shield + Defense</em>. Whip uses <em>Slow</em> mastery. Keep an eye out for a <strong>masonry moment</strong>—Malc will want to sanctify it.
      </div>

    </div>

    <!-- RIGHT -->
    <div style="display:flex;flex-direction:column;gap:14px;">

      <div class="section">
        <div class="section-title">Origin</div>
        <div class="section-body">
          <div class="lore-box" id="backstory-short">
            Malc Grann, meaning Strong Wall, is what this Gnome calls himself. Self-proclaimed “Wall God.” Bright-eyed and excited to discuss and examine any sufficiently sturdy looking wall. His dream is to build the biggest and best wall that anyone has ever seen and declare it his temple!
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Appearance Notes</div>
        <div class="section-body">
          <div class="lore-box" id="appearance-notes">
            Platinum-blonde hair, tan skin, topaz eyes. Compact (3'6") but built like a cornerstone. Armor scuffed with honest work; small brass gears and mason’s chalk tucked into every strap. Smiles like a door you can’t lock.
          </div>
        </div>
      </div>

      <!-- ADDITIONAL FEATURES -->
      <div class="section">
        <div class="section-title">Additional Features &amp; Traits</div>
        <div class="section-body" style="padding:0;" id="additional-features">
          <details class="feature-item">
            <summary class="feature-toggle" style="padding:10px 14px;">
              <div class="feature-gem"></div>
              <span class="feat-name">Gnomish Cunning</span>
              <span class="feat-short">Resilience</span>
              <span class="feat-arrow">▶</span>
            </summary>
            <div class="feature-detail">Advantage on saving throws against magic that target <strong>INT</strong>, <strong>WIS</strong>, or <strong>CHA</strong>.</div>
          </details>

          <details class="feature-item">
            <summary class="feature-toggle" style="padding:10px 14px;">
              <div class="feature-gem"></div>
              <span class="feat-name">Mason's Tools</span>
              <span class="feat-short">Craft</span>
              <span class="feat-arrow">▶</span>
            </summary>
            <div class="feature-detail">Given 10 minutes and materials, Malc can <em>stabilize</em> a weak structure or assess how it will fail. He calls this “listening to the wall.”</div>
          </details>

          <details class="feature-item">
            <summary class="feature-toggle" style="padding:10px 14px;">
              <div class="feature-gem"></div>
              <span class="feat-name">Folk Hero</span>
              <span class="feat-short">Background</span>
              <span class="feat-arrow">▶</span>
            </summary>
            <div class="feature-detail">Common folk recognize the look of someone who <strong>showed up</strong> when it mattered. Malc can usually find shelter and support among them.</div>
          </details>
        </div>
      </div>

    </div><!-- end right -->
  </div>
</div><!-- end page 2 -->


<script>
  // Attack row expand
  function toggleAtk(id) {
    const panel = document.getElementById(id);
    const chvId = 'chv' + id.replace('atk','');
    const chv = document.getElementById(chvId);
    if (panel) panel.classList.toggle('open');
    if (chv) chv.classList.toggle('open');
  }

  // Death save pips
  document.querySelectorAll('.pip').forEach(pip => {
    pip.addEventListener('click', () => {
      const on = pip.dataset.on === '1';
      const fail = pip.dataset.fail === '1';
      pip.style.background = on ? '' : (fail ? '#8b1a1a' : 'var(--primary-light)');
      pip.style.borderColor = on ? '' : (fail ? '#cc2222' : 'var(--accent-light)');
      pip.dataset.on = on ? '0' : '1';
    });
  });

  // Second wind pips
  document.querySelectorAll('.wind-pip').forEach(p => {
    p.addEventListener('click', () => p.classList.toggle('active'));
  });
</script>

<script>
(async function () {
  const CHAR = document.body.dataset.character || "malc";

  async function loadPlayer() {
    const candidates = ["../player.json","../../player.json","../../../player.json","/dnd/player.json","/player.json","./player.json"];
    for (const url of candidates) {
      try {
        const r = await fetch(url, { cache: "no-store" });
        if (!r.ok) continue;
        return await r.json();
      } catch (_) {}
    }
    throw new Error("Could not load player.json");
  }

  function abMod(score) {
    const n = Number(score);
    if (!Number.isFinite(n)) return "";
    const m = Math.floor((n - 10) / 2);
    return (m >= 0 ? "+" : "") + m;
  }

  function setText(el, v) { if (!el) return; el.textContent = (v === undefined || v === null) ? "" : String(v); }

  try {
    const data = await loadPlayer();
    const c = data?.characters?.[CHAR];
    if (!c) throw new Error(`Character "${CHAR}" not found in player.json`);

    // Name banner
    setText(document.querySelector(".char-name-big"), c.name ?? "—");

    // Info grid
    document.querySelectorAll(".info-cell").forEach(cell => {
      const label = (cell.querySelector(".info-label")?.textContent || "").trim().toLowerCase();
      const valEl = cell.querySelector(".info-value");
      if (!valEl) return;

      if (label.startsWith("class")) {
        const lvl = c.level ?? "";
        const cls = c.class ?? "";
        valEl.textContent = `LVL ${lvl} ${cls}`.trim();
      } else if (label.startsWith("background")) {
        if (c.background != null) valEl.textContent = c.background;
      } else if (label.startsWith("player")) {
        valEl.textContent = c.player ?? valEl.textContent;
      } else if (label.startsWith("race")) {
        if (c.race != null) valEl.textContent = c.race;
      } else if (label.startsWith("alignment")) {
        if (c.alignment != null) valEl.textContent = c.alignment;
      } else if (label.startsWith("experience")) {
        if (c.xp != null) valEl.textContent = String(c.xp);
      }
    });

    // Abilities + mods
    const abMap = {
      "strength": "str",
      "dexterity": "dex",
      "constitution": "con",
      "intelligence": "int",
      "wisdom": "wis",
      "charisma": "cha"
    };
    document.querySelectorAll(".ability-block").forEach(block => {
      const nm = (block.querySelector(".ab-name")?.textContent || "").trim().toLowerCase();
      const key = abMap[nm];
      if (!key) return;
      const score = c.abilities?.[key];
      if (score == null) return;
      setText(block.querySelector(".ab-score"), score);
      setText(block.querySelector(".ab-mod-box"), abMod(score));
    });

    // Proficiency
    if (c.combat?.proficiency_bonus != null) setText(document.querySelector(".prof-val"), c.combat.proficiency_bonus);

    // Combat row
    document.querySelectorAll(".combat-stat").forEach(stat => {
      const lbl = (stat.querySelector(".cs-lbl")?.textContent || "").trim().toLowerCase();
      const valEl = stat.querySelector(".cs-val");
      if (!valEl) return;
      if (lbl.includes("armor")) setText(valEl, c.combat?.ac ?? valEl.textContent);
      else if (lbl.includes("initiative")) setText(valEl, c.combat?.initiative ?? valEl.textContent);
      else if (lbl.includes("speed")) setText(valEl, c.combat?.speed ?? valEl.textContent);
    });

    // HP
    const max = c.hp?.max ?? c.combat?.hp_max ?? c.combat?.hpMax;
    const cur = c.hp?.current ?? c.combat?.hp_current ?? c.combat?.hpCurrent ?? max;
    if (max != null) setText(document.getElementById("hp-max"), max);
    if (cur != null) setText(document.getElementById("hp-current"), cur);
    if (c.combat?.hit_dice != null) setText(document.getElementById("hit-dice"), c.combat.hit_dice);

    // Passive perception
    if (c.combat?.passive_perception != null) setText(document.getElementById("pp-val"), c.combat.passive_perception);

    // Saves
    const savesEl = document.getElementById("saves-list");
    if (savesEl && c.saving_throws) {
      const order = [
        ["Strength","str"],["Dexterity","dex"],["Constitution","con"],
        ["Intelligence","int"],["Wisdom","wis"],["Charisma","cha"]
      ];
      savesEl.innerHTML = "";
      order.forEach(([nm,key]) => {
        const s = c.saving_throws?.[key];
        const row = document.createElement("div");
        row.className = "save-row";
        const filled = s?.proficient ? " filled" : "";
        row.innerHTML = `<div class="dot${filled}"></div><span class="save-name">${nm}</span><span class="save-val">${s?.bonus ?? ""}</span>`;
        savesEl.appendChild(row);
      });
    }

    // Skills (array)
    const skillsGrid = document.getElementById("skills-grid");
    if (skillsGrid && Array.isArray(c.skills)) {
      skillsGrid.innerHTML = "";
      c.skills.forEach(sk => {
        const row = document.createElement("div");
        row.className = "skill-row";
        const prof = sk.proficient ? " filled" : "";
        row.innerHTML = `<div class="dot${prof}"></div><span class="skill-name">${sk.name}</span><span class="skill-ab">(${sk.ability})</span><span class="skill-val">${sk.bonus}</span>`;
        skillsGrid.appendChild(row);
      });
    }

    // Attacks/weapons (array)
    const attacksBody = document.getElementById("attacks-body");
    if (attacksBody && Array.isArray(c.weapons)) {
      attacksBody.innerHTML = "";
      let idx = 1;
      c.weapons.forEach(w => {
        const id = `atk${idx}`;
        const chv = `chv${idx}`;
        const name = w.name ?? "—";
        const toHit = w.attack ?? w.toHit ?? "—";
        const dmg = (w.damage != null) ? w.damage : (w.damage_string ?? "");
        const type = w.damage_type ?? w.type ?? "";
        const line = `${dmg}${type ? " " + type : ""}`.trim();

        const tr1 = document.createElement("tr");
        tr1.innerHTML = `<td class="attack-name-cell" onclick="toggleAtk('${id}',this)">${name} <span class="atk-chevron" id="${chv}">▶</span></td><td class="val">${toHit}</td><td>${line}</td>`;
        attacksBody.appendChild(tr1);

        const tr2 = document.createElement("tr");
        tr2.className = "attack-detail-row";
        const detail = (w.detail || w.notes || "").trim();
        tr2.innerHTML = `<td colspan="3"><div class="attack-expand" id="${id}">${detail || "—"}</div></td>`;
        attacksBody.appendChild(tr2);

        idx += 1;
      });
    }

    // Features (array)
    const featList = document.getElementById("features-list");
    if (featList && Array.isArray(c.features)) {
      featList.innerHTML = "";
      c.features.forEach(f => {
        const d = document.createElement("details");
        d.className = "feature-item";
        d.innerHTML = `
          <summary class="feature-toggle" style="padding:10px 14px;">
            <div class="feature-gem"></div>
            <span class="feat-name">${f.name ?? "—"}</span>
            <span class="feat-short">${f.short ?? ""}</span>
            <span class="feat-arrow">▶</span>
          </summary>
          <div class="feature-detail">${(f.desc ?? "").replaceAll("\n","<br>")}</div>`;
        featList.appendChild(d);
      });
    }

    // Equipment
    const eq = document.getElementById("equip-grid");
    if (eq && Array.isArray(c.equipment)) {
      eq.innerHTML = "";
      c.equipment.forEach(it => {
        const div = document.createElement("div");
        div.className = "equip-item";
        div.textContent = it;
        eq.appendChild(div);
      });
      if (Number.isFinite(Number(c.gold))) {
        const div = document.createElement("div");
        div.className = "equip-item";
        div.textContent = `${c.gold} Gold Pieces`;
        eq.appendChild(div);
      }
    }

    // Traits
    if (c.traits) {
      document.querySelectorAll("[data-trait]").forEach(el => {
        const k = el.getAttribute("data-trait");
        if (c.traits?.[k] != null) el.textContent = c.traits[k];
      });
    }

    // Backstory / quote
    if (c.quote) setText(document.getElementById("quote-text"), c.quote);
    if (c.backstory?.short) setText(document.getElementById("backstory-short"), c.backstory.short);

    // Portrait
    const portrait = c.portrait || c.portrait_path;
    if (portrait) document.getElementById("portrait-img")?.setAttribute("src", portrait);

  } catch (e) {
    console.warn("[Textsheet Loader] Using fallback hardcoded values.", e);
  }
})();
</script>

</body>
</html>
